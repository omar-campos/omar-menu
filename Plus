#!/bin/bash

# ==============================
#  SCRIPT SEGURO OPTIMIZADO
#  EDITADO PARA: @omarcampos
# ==============================

clear

# --- Verificación de root ---
if [[ "$(id -u)" != "0" ]]; then
    echo -e "\033[1;31mErro:\033[0m você precisa executar como root."
    exit 1
fi

# --- Variáveis decodificadas ---
_lnk="soulsaude.ns"
_Ink="/usr/local/lib"
_1nk="/usr/lib"

# Garantir diretórios
mkdir -p "$_Ink"

# --- Função de barra de progresso ---
fun_bar() {
    comando="$1"

    (
        [[ -e "$HOME/fim" ]] && rm "$HOME/fim"
        $comando > /dev/null 2>&1
        touch "$HOME/fim"
    ) &> /dev/null &

    tput civis
    echo -ne "  \033[1;37mAGUARDE \033[1;37m["

    while true; do
        for ((i=0; i<18; i++)); do
            echo -ne "\033[1;31m#"
            sleep 0.1
        done

        if [[ -e "$HOME/fim" ]]; then
            rm "$HOME/fim" && break
        fi

        echo -e "\033[1;37m]"
        tput cuu1
        tput dl1
        echo -ne "  \033[1;37mAGUARDE \033[1;37m["
    done

    echo -e "\033[1;37m]\033[1;32m OK!\033[0m"
    tput cnorm
}

# --- Tela inicial ---
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
echo -e "\E[38;5;118m ⇱ BEM-VINDO AO SCRIPT DO SHUMELO ⇲"
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"

echo -e "\n\033[1;31mATENÇÃO:\033[1;37m este script instalará funções de gerenciamento."
echo -e "\033[1;31mRecomendado:\033[1;37m Ubuntu 18.x"
echo -e "\033[1;31mNão suportado:\033[1;37m CPU ARM"
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"

echo -e "\033[1;37m[1]\033[1;32m Iniciar instalação"
echo -e "\033[1;37m[2]\033[1;31m Cancelar\033[0m"
echo
read -p "Digite sua opção: " opcao

case "$opcao" in
1)
    echo -e "\n\033[1;32mIniciando instalação...\033[0m"
    ;;
2)
    echo -e "\n\033[1;31mInstalação cancelada.\033[0m"
    exit 0
    ;;
*)
    echo -e "\033[1;31mOpção inválida.\033[0m"
    exit 1
    ;;
esac

# ==============================
#       INÍCIO INSTALAÇÃO
# ==============================

fun_attlist() {
    apt-get update -y
    apt-get install -y lolcat figlet curl git boxes nano unzip jq python3 python3-pip net-tools lsof
}
fun_bar fun_attlist

# --- Instalar Python & libs de forma segura ---
fun_python() {
    pip3 install speedtest-cli > /dev/null 2>&1
}
fun_bar fun_python

# --- Instalação dos scripts principais ---
fun_instalar_scripts() {
    cd /bin
    rm -f v2raymanager botteste.sh

    wget -q https://raw.githubusercontent.com/omar-campos/omar-menu/main/M/v2raymanager
    wget -q https://raw.githubusercontent.com/omar-campos/omar-menu/main/M/botteste.sh

    chmod +x v2raymanager
    chmod +x botteste.sh

    mkdir -p $HOME/BOT
    cd $HOME/BOT
    wget -q https://raw.githubusercontent.com/omar-campos/omar-menu/main/I/ShellBot.sh
    chmod +x ShellBot.sh
}
fun_bar fun_instalar_scripts

# --- Criar menu ---
echo "/bin/menu" > /bin/h
chmod +x /bin/h

# --- Finalização ---
clear
echo -e "\033[1;32mInstalação concluída!\033[0m"
echo -e "\nDigite \033[1;36mmenu\033[0m para iniciar."

# --- Limpeza ---
rm -f $HOME/Plus
history -c
> ~/.bash_history

